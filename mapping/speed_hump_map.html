<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Crash Map</title>
  <meta name="description" content="Smarter Cities">
  <meta name="author" content="Lucio Tolentino">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
</head>

<body class="body">
    
	<h1> HUMPS </h1>
	<div id = 'humps' style="width: 100%; height: 800px; background-color: lightgray;">
	</div>
	
	<script>
	
	//make map of humps
		var map = L.map("humps").setView([40.772125, -73.974792], 15);
	L.tileLayer('http://{s}.tiles.mapbox.com/v3/seanluciotolentino.jhknj4m5/{z}/{x}/{y}.png', {
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		maxZoom: 15
	}).addTo(map);
	
	//define points
	$.get("http://127.0.0.1:5000/humps",{}).then(function(data){
        //console.log(data)
        //console.log(data.markers)
    
	    //add circles
	    (data.markers).forEach(function(c){
	    	console.log(c)
	    	L.circle([c.lat, c.lon], 200, {
	    	    color: c.color,
	    	    fillColor: c.color,
	    	    fillOpacity: 0.5
       	}).addTo(map);
	    });

	    //add markers
	    (data.markers).forEach(function(marker){
		    L.marker([marker.lat, marker.lon]).addTo(map)
				    .bindPopup("<html>"+
                                "<b>" + marker.date + "</b><br>"+
                                "3 month percent decrease: " + marker.PD3+"<br>"+
                                "6 month percent decrease: " + marker.PD6+"<br>"+
                                "=========================<br>"+
                                "Crashes 3 month before: " + marker.crashes3b+"<br>"+
                                "Crashes 3 month after: " + marker.crashes3a+"<br>"+
                                "Crashes 6 month before: " + marker.crashes6b+"<br>"+
                                "Crashes 6 month after: " + marker.crashes6a+
                                "</html>"
                                )
	    });
	});

    </script>
    
</body>
</html>

